
<div>
    <p class="mb-2">
      You can set up this device to log in quickly with a biometric authentication
      (Fingerprint Reader or Facial Recognition), or using a hardware security key. Click
      Below to get started.
    </p>
    <button
        class="py-2 px-4 bg-green-600 font-bold uppercase shadow text-white rounded"
        id="start-registration"
    >Setup Device Authentication
    </button>
  </div>
  <script>
    const startRegistrationButton = document.getElementById('start-registration');
  
    startRegistrationButton.addEventListener('click', async () => {
      const options = {{ public_credential_creation_options | safe }};
  
      let attResp;
      try {
        attResp = await startRegistration({ optionsJSON: options});
      } catch (error) {
        alert("Something went wrong");
        console.error(error);
      }
  
      const verificationResp = await fetch('{{ url_for("webauthn.save_webauthn") }}', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token() }}'
        },
        body: JSON.stringify(attResp)
      });
      const verificationJSON = await verificationResp.json();
  
      if (verificationJSON && verificationJSON.verified) {
        alert("Success");
      } else {
        alert("Failure");
      }
    })
  </script>
  